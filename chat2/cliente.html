<!DOCTYPE html>
<html>

<head>
    <title>Fila de Atendimento</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.2/dist/peerjs.min.js"></script>
</head>

<body>
    <h1>Fila de Atendimento</h1>
    <video id="remote-video" autoplay></video>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        atendenteId = urlParams.get('id');
        if (atendenteId == undefined) {
        throw new Error("usuario nao identificado!");
        }
        console.log(atendenteId);

        const remoteVideo = document.getElementById('remote-video');

        const peer = new Peer();
        //navigator.mediaDevices.getUserMedia({ video: false, audio: true }).then(stream => {
         //   console.log("audio");
          //  console.log(atendenteId);
          //  var call = peer.call(atendenteId, stream);
          var call = peer.call(atendenteId, null);
          call.on('stream', function (remoteStream) {
             remoteVideo.srcObject = remoteStream;
          });
        //});

//        function findAtendente() {
//           const remoteVideo = document.getElementById('remote-video');
//            const strAtendenteId = document.getElementById('atendente-id');
//            const atendenteId = ""

//            fetch("https://chat.sociap.com.br/atendente/get")
//            .then(res => { return res.json() })
//            .then(response => {
//                console.log('Aqui2!!');
 //               console.log(response);
 //               strAtendenteId.textContent = response.peer;
 //               atendenteId = response.peer;
 //               if (atendenteId  != "") {
 //                   navigator.mediaDevices.getUserMedia({ video: false, audio: true }).then(stream => {
  //                      console.log("audio");
 //                       console.log(atendenteId);
  //                      var call = peer.call(atendenteId, stream);
 //                       call.on('stream', function (remoteStream) {
//                            remoteVideo.srcObject = remoteStream;
//                        });
//                        aguardandoAtendimento = false;
 //                   });
 //                   console.log("hello world");
//                }
//            })
//            if (aguardandoAtendimento) {
//                console.log('Hello');
//                sleep(2000).then(() => { console.log('World!'); });
//            }
//        }

//        const peer = new Peer();

        // const aguardandoAtendimento = true
///        findAtendente()

    </script>
</body>

</html>