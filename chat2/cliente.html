<!DOCTYPE html>
<html>

<head>
    <title>Fila de Atendimento</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.2/dist/peerjs.min.js"></script>
</head>

<body>
    <h1>Fila de Atendimento</h1>
    <div id="atendente-id"></div>
    <video id="remote-video" autoplay></video>
    PL2

    <script>
        const peer = new Peer();

        const remoteVideo = document.getElementById('remote-video');
        const atendenteId = document.getElementById('atendente-id');

        fetch("https://chat.sociap.com.br/atendente/get")
            .then(res => { return res.json() })
            .then(response => {
                console.log(response);
                atendenteId.textContent = response;

                navigator.mediaDevices.getUserMedia({ video: false, audio: true }).then(stream => {
                    console.log('Aqui!!');
                    var call = peer.call(response.peer, stream);
                    call.on('stream', function (remoteStream) {
                        remoteVideo.srcObject = remoteStream;
                    });
                }, function (err) {
                    console.log('Failed to get local stream', err);
                });
            });

    </script>
</body>

</html>